{"status":{},"contains_secrets":false,"product_version":"3.0.6","spec":{"description":"Framework to deploy the Udacity HCE student evaluation environment","resources":{"client_attrs":{"b2b89173_deployment":{"y":571,"x":874.5}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"UdacityEval"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"498e575a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ce7ed122_runbook","main_task_local_reference":{"kind":"app_task","name":"498e575a_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"UdacityEval"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"060b39bb_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ab4d7cba_runbook","main_task_local_reference":{"kind":"app_task","name":"060b39bb_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"UdacityEval"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"122f47ee_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"68ed988b_runbook","main_task_local_reference":{"kind":"app_task","name":"122f47ee_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"UdacityEval"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"1f8d5659_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9f7c9100_runbook","main_task_local_reference":{"kind":"app_task","name":"1f8d5659_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"UdacityEval"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c56d2fde_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2dd9f0fb_runbook","main_task_local_reference":{"kind":"app_task","name":"c56d2fde_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"UdacityEval","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"UdacityEvalVm","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"editables":{"create_spec":{"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"vm-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"3b6477b0-2cdb-4a3b-9ee8-d93563738959"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{teccadmin.username}@@\n    ssh-authorized-keys:\n      - @@{teccadmin.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"24beaac4-5024-4d96-9b93-d9bbf520f645","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS7","uuid":"7e7d8b68-8e6c-80a3-aba8-90504b1a111f"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"teccadmin","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"teccadmin"},{"username":"admin","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"PC_Credentials","editables":{"username":true,"secret":true}}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"UdacityEval"}],"name":"PackageInstall","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"PackageInstall"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ConfigureBaseVm"},{"kind":"app_task","name":"InstallCalmDsl"},{"kind":"app_task","name":"InstallEval"},{"kind":"app_task","name":"TestEval"}],"name":"aeb1e96c_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ConfigureBaseVm"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"InstallCalmDsl"}},{"from_task_reference":{"kind":"app_task","name":"InstallCalmDsl"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"InstallEval"}},{"from_task_reference":{"kind":"app_task","name":"InstallEval"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"TestEval"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"UdacityEval"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ConfigureBaseVm","attrs":{"script":"#!\/bin\/bash\n\n# update base OS packages\n# sudo yum -y update\n# sudo yum -y upgrade\n\n# install some useful packages\nsudo yum -y install vim","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"UdacityEval"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"InstallCalmDsl","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n# fix centos7 mirror issues\n# this may be required if there are yum issues\n# sudo sed -i 's\/mirrorlist=\/#mirrorlist=\/g' \/etc\/yum.repos.d\/CentOS-Base.repo\n# sudo sed -i 's\/#baseurl=http:.*mirror.centos.org\\\/centos\\\/\/baseurl=@@{CENTOS_REPO}@@\/g' \/etc\/yum.repos.d\/CentOS-Base.repo\nsudo yum -y update\n\n# Update and install yum packages\nsudo yum -y install nmap git gcc openssl-devel\n# sudo yum -y install xorg-x11-server-Xorg xorg-x11-xauth xorg-x11-apps\nsudo yum -y install https:\/\/repo.ius.io\/ius-release-el7.rpm\nsudo yum -y install python36u python36u-libs python36u-devel python36u-pip\n\n# make python3 default\n# sudo rm \/usr\/bin\/python\n# sudo ln -s \/usr\/bin\/python3.6 \/usr\/bin\/python\n# sudo ln -s \/usr\/bin\/pip3 \/usr\/bin\/pip\n\n# update pip, install virtualenv\nsudo pip3 install -q -U pip\nsudo pip3 install -q -U virtualenv\n\n# install calm dsl\nmkdir -p ~\/nutanix\ncd ~\/nutanix\ngit clone https:\/\/github.com\/nutanix\/calm-dsl.git\ncd ~\/nutanix\/calm-dsl\/\n\n# build the dsl\nmake --no-print-directory dev\n\n# carry out a quick test\ncd ~\/nutanix\/calm-dsl\/\nsource venv\/bin\/activate\ncalm init dsl --ip @@{PC_IP}@@ --port @@{PC_PORT}@@ --username @@{PC_Credentials.username}@@ --password '@@{PC_Credentials.secret}@@' --project @@{DEFAULT_PROJECT}@@\ncalm get bps\n\n# deactivate the venv\ndeactivate","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"UdacityEval"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"InstallEval","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n# install prerequisites for the eval process\nsudo yum -y install jq curl\n\n# download the eval script and sample eval json file\nmkdir -p @@{EVAL_DIR}@@\ncd @@{EVAL_DIR}@@\ncurl -L -O https:\/\/raw.githubusercontent.com\/nutanixdev\/udacity\/main\/HybridCloudEngineer\/eval\/script\/eval.bash\ncurl -L -O https:\/\/raw.githubusercontent.com\/nutanixdev\/udacity\/main\/HybridCloudEngineer\/eval\/criteria\/eval.json\ncurl -L -O https:\/\/raw.githubusercontent.com\/nutanixdev\/udacity\/main\/HybridCloudEngineer\/eval\/blueprints\/basiclinuxvm_test.json\ncurl -L -O https:\/\/raw.githubusercontent.com\/nutanixdev\/udacity\/main\/HybridCloudEngineer\/eval\/blueprints\/basiclinuxvm_test_2.json\nchmod u+x @@{EVAL_DIR}@@\/eval.bash\n\n# make sure the files are there\n# this step is only useful when testing the script from Calm or when looking at the deployment output\nls -la @@{EVAL_DIR}@@\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"UdacityEval"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"TestEval","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n# activate calm dsl venv\ncd ~\/nutanix\/calm-dsl\nsource venv\/bin\/activate\n\n# run a test to make sure the eval script works\ncd @@{EVAL_DIR}@@\n.\/eval.bash -c eval.json -d . -b all\n\n# deactivate the venv\ndeactivate\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"05a86072_runbook","main_task_local_reference":{"kind":"app_task","name":"aeb1e96c_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"PackageInstall"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"689d9695_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a7d67a33_runbook","main_task_local_reference":{"kind":"app_task","name":"689d9695_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS8","version":"","options":{"type":"","name":"CentOS8","resources":{"image_type":"DISK_IMAGE","checksum":{},"source_uri":"https:\/\/cloud.centos.org\/centos\/8\/x86_64\/images\/CentOS-8-GenericCloud-8.2.2004-20200611.2.x86_64.qcow2","version":{"product_version":"8.2.2004","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS7","version":"","options":{"type":"","name":"CentOS7","resources":{"image_type":"DISK_IMAGE","checksum":{},"source_uri":"https:\/\/cloud.centos.org\/centos\/7\/images\/CentOS-7-x86_64-GenericCloud.qcow2","version":{"product_version":"7","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"b2b89173_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"PackageInstall"}],"substrate_local_reference":{"kind":"app_substrate","name":"UdacityEvalVm"},"variable_list":[],"description":""}],"description":"","action_list":[],"name":"Default","variable_list":[{"regex":{"should_validate":true,"value":"^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$"},"val_type":"STRING","is_mandatory":false,"description":"Administrative endpoint for access\nRegExp from https:\/\/www.regular-expressions.info\/ip.html","data_type":"BASE","type":"LOCAL","library_reference":"69e05f57-9c6d-4ffc-9cde-302d6f9a5a02","name":"PC_IP","value":"192.168.1.0","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"regex":{"should_validate":false,"value":"^[\\d]*$"},"val_type":"INT","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"PC_PORT","value":"9440","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DEFAULT_PROJECT","value":"default","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"CENTOS_REPO","value":"http:\/\/mirror.aarnet.edu.au\/pub\/centos\/","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"EVAL_DIR","value":"~\/nutanix\/udacity_eval","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"teccadmin"},"type":"USER"},"name":"Udacity-HybridCloudEngineer-Evaluation"},"api_version":"3.0","metadata":{"last_update_time":"1602039603446440","kind":"blueprint","spec_version":34,"creation_time":"1601352027737293","name":"Udacity-HybridCloudEngineer-Evaluation"}}